# Role-Permission Management Service

gRPC-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏ –º–µ–∂–¥—É —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞.

üîó **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏ "–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º" –º–µ–∂–¥—É —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∏–µ–Ω—Ç—É –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ü–∞–∫–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∞–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–æ–≤
- –ú–µ–∂–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é client_id + app_id

üóÉ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**

### –¢–∞–±–ª–∏—Ü–∞ `role_permissions`
–ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ
-----|-----|-------------|----------
role_id | UUID | PRIMARY KEY, REFERENCES roles(id) ON DELETE CASCADE | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–æ–ª–∏
permission_id | UUID | PRIMARY KEY, REFERENCES permissions(id) ON DELETE CASCADE | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–∞–≤–∞

### –ò–Ω–¥–µ–∫—Å—ã
- `role_permissions_permission_idx` (permission_id)
- `idx_role_permissions_role` (role_id)
- `idx_role_permissions_composite` (role_id, permission_id)

## üì° API –ú–µ—Ç–æ–¥—ã

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –∫ —Ä–æ–ª–∏ (AddPermissionsToRole)
```protobuf
rpc AddPermissionsToRole(PermissionsRequest) returns (OperationStatus);

message PermissionsRequest {
  string role_id = 1;
  string client_id = 2;
  int32 app_id = 3;
  repeated string permission_ids = 4;
}
```
**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**

```json
{
  "role_id": "bc870624-ea19-4cc9-951e-9cb19b740812",
  "client_id": "8268ec76-d6c2-48b5-a0e4-a9c2538b8f48",
  "app_id": 1,
  "permission_ids": ["30a7b096-2248-48c9-9427-197cd00bce1f"]
}
```
**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**
```json
{
  "success": true,
  "message": "Successfully added 1 permissions",
  "timestamp": {
    "seconds": "1745906417",
    "nanos": 95267800
  }
}
```
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
- –ü–∞–∫–µ—Ç–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤ –æ–¥–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤

**–û—à–∏–±–∫–∏**
```json
{
  "code": 3,
  "message": "Permission not found"
}
```
### 2. –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –∏–∑ —Ä–æ–ª–∏ (RemovePermissionsFromRole)
```protobuf
rpc RemovePermissionsFromRole(PermissionsRequest) returns (OperationStatus);

message PermissionsRequest {
  string role_id = 1;
  string client_id = 2;
  int32 app_id = 3;
  repeated string permission_ids = 4;
}
```
**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**

```json
{
  "role_id": "bc870624-ea19-4cc9-951e-9cb19b740812",
  "client_id": "8268ec76-d6c2-48b5-a0e4-a9c2538b8f48",
  "app_id": 1,
  "permission_ids": ["30a7b096-2248-48c9-9427-197cd00bce1f"]
}
```
**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**
```json
{
  "success": true,
  "message": "Removed 1/1 permissions",
  "timestamp": {
    "seconds": "1745906868",
    "nanos": 938520200
  }
}
```
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
- –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∞–≤
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ (HasPermission)
```protobuf
rpc HasPermission(HasPermissionRequest) returns (HasPermissionResponse);

message HasPermissionRequest {
  string role_id = 1;
  string client_id = 2;
  string permission_id = 3;
  int32 app_id = 4;
}
```
**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**
```json
{
  "role_id": "bc870624-ea19-4cc9-951e-9cb19b740812",
  "client_id": "8268ec76-d6c2-48b5-a0e4-a9c2538b8f48",
  "app_id": 1,
  "permission_id": "30a7b096-2248-48c9-9427-197cd00bce1f"
}
```
**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**
```json
{
  "has_permission": true,
  "checked_at": {
    "seconds": "1745906707",
    "nanos": 42958700
  }
}
```
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–æ–≤
- –ú–µ–∂–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è

### 4. –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤ –¥–ª—è —Ä–æ–ª–∏ (ListPermissionsForRole)
```protobuf
rpc ListPermissionsForRole(ListPermissionsRequest) returns (ListPermissionsResponse);

message ListPermissionsRequest {
  string role_id = 1;
  string client_id = 2;
  int32 app_id = 3;
}
```
**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**
```json
{
  "role_id": "bc870624-ea19-4cc9-951e-9cb19b740812",
  "client_id": "8268ec76-d6c2-48b5-a0e4-a9c2538b8f48",
  "app_id": 1
}

```
**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**
```json
{
  "permission_ids": [
    "30a7b096-2248-48c9-9427-197cd00bce1f"
  ]
}
```
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ —Ä–æ–ª–∏ –∫–ª–∏–µ–Ω—Ç—É
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

### 5. –°–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π –¥–ª—è –ø—Ä–∞–≤–∞ (ListRolesForPermission)
```protobuf
rpc ListRolesForPermission(ListRolesRequest) returns (ListRolesResponse);

message ListRolesRequest {
  string permission_id = 1;
  string client_id = 2;
  int32 app_id = 3;
}
```
**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**
```json
{
  "permission_id": "30a7b096-2248-48c9-9427-197cd00bce1f",
  "client_id": "8268ec76-d6c2-48b5-a0e4-a9c2538b8f48",
  "app_id": 1
}
```
**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**
```json
{
  "role_ids": [
    "bc870624-ea19-4cc9-951e-9cb19b740812"
  ]
}
```
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–æ–ª–µ–π
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∞–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

### üõ°Ô∏è –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ client_id –∏ app_id –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è UUID –Ω–∞ —É—Ä–æ–≤–Ω–µ API
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–≤—è–∑–µ–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–∞–≤ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é (1000)

### üîê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ó–∞–ø—Ä–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å–≤—è–∑–µ–π
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –≤ –ª–æ–≥–∞—Ö

### üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –¢–∞–±–ª–∏—Ü–∞ roles —Å –ø–æ–ª—è–º–∏: id, client_id, app_id, is_active
- –¢–∞–±–ª–∏—Ü–∞ permissions —Å –ø–æ–ª—è–º–∏: id, app_id, is_active
- PostgreSQL 14+ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º pgcrypto
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏: pgx/v5, google.golang.org/protobuf